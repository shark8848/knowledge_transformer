# 知识文档格式转换引擎接口定义表

## 基本信息

服务名称：知识文档格式转换引擎API接口
请求方：知识加工编排
响应方：知识文档格式转换引擎
服务地址：http://{IP地址}:{端口}/km/rag/knowledgeTransformer/api/v1/convert
请求方式：POST
编码格式：UTF-8
数据格式：JSON
Content-Type：application/json
接口类型：知识文档格式转换引擎API接口

## 入参字段（Body）
| 父参数 | 参数 | 类型 | 长度 | 必选 | 说明 |
|---|---|---|---|---|---|
| root | task_name | string | - | 是 | 任务名称 |
| root | priority | string | - | 否 | 优先级：`low`/`normal`/`high`，默认 `normal` |
| root | mode | string | - | 否 | 执行模式：`async`（默认，入队）或 `sync`（同步返回结果，仅单文件小体积） |
| root | callback_url | string | - | 否 | 回调 URL，异步完成后推送结果 |
| root | storage | object | - | 否 | 对象存储覆盖配置（不填则用服务端默认） |
| storage | endpoint | string | - | 否 | 对象存储地址，如 `http://minio:9000` |
| storage | access_key | string | - | 否 | 存储访问密钥 |
| storage | secret_key | string | - | 否 | 存储密钥 |
| storage | bucket | string | - | 否 | 目标桶名 |
| root | files | array | - | 是 | 待转换文件列表 |
| files[] | source_format | string | - | 是 | 源格式，如 `doc`、`svg`、`wav` |
| files[] | target_format | string | - | 是 | 目标格式，如 `docx`、`png`、`mp3` |
| files[] | input_url | string | - | 否 | 下载 URL（三选一） |
| files[] | object_key | string | - | 否 | 对象键名（三选一） |
| files[] | base64_data | string | - | 否 | 内联 base64 数据（三选一） |
| files[] | filename | string | - | 否 | 文件名，常配合 base64_data 使用 |
| files[] | size_mb | number | - | 是 | 文件大小（MB），用于校验 |
| files[] | page_limit | number | - | 否 | 文档页数裁剪，仅 `doc/docx/html/ppt/pptx`，与 duration_seconds 互斥 |
| files[] | duration_seconds | number | - | 否 | 音视频/动图时长裁剪，仅音视频/gif，互斥 |

## 出参字段（ResBean）
| 父参数 | 参数 | 类型 | 长度 | 必选 | 说明 |
|---|---|---|---|---|---|
| root | errCode | string | V6 | 是 | 接口返回码；成功：`000000`；失败：`000001`/`999999` 等 |
| root | errMsg | string | V200 | 是 | 返回消息描述 |
| root | status | boolean | - | 是 | 业务处理状态，`true` 成功，`false` 失败 |
| root | data | object | - | 是 | `/api/v1/convert` 返回体（见下） |
| data | status | string | - | 是 | `accepted`/`success`/`failure` |
| data | task_id | string | - | 否 | 任务 ID |
| data | message | string | - | 否 | 描述信息 |
| data | error_code | string | - | 否 | 失败时错误码（如 `ERR_FORMAT_UNSUPPORTED`） |
| data | error_status | number | - | 否 | 失败时 HTTP 状态码 |
| data | results | array | - | 否 | 同步或回调时的结果列表 |
| results[] | source | string | - | 是 | 源格式 |
| results[] | target | string | - | 是 | 目标格式 |
| results[] | status | string | - | 是 | `success`/`failed` |
| results[] | object_key | string | - | 否 | 输出对象键 |
| results[] | output_path | string | - | 否 | 本地输出路径（若存在） |
| results[] | metadata | object | - | 否 | 插件返回的元数据（如 page_limit/duration/notes） |
| results[] | reason | string | - | 否 | 失败原因（含 source 定位） |

## 报文样例

### 入参示例
```json
{
  "task_name": "batch-office-conversion",
  "priority": "high",
  "mode": "async",
  "callback_url": "https://your-service.com/webhook/conversion-complete",
  "storage": {
    "endpoint": "http://minio:9000",
    "access_key": "your-ak",
    "secret_key": "your-sk",
    "bucket": "custom-bucket"
  },
  "files": [
    {
      "source_format": "doc",
      "target_format": "docx",
      "input_url": "https://storage.example.com/documents/report.doc",
      "object_key": "uploads/2025/report.doc",
      "filename": "report.doc",
      "size_mb": 2.5
    },
    {
      "source_format": "svg",
      "target_format": "png",
      "input_url": "https://storage.example.com/images/diagram.svg",
      "size_mb": 0.8,
      "page_limit": null,
      "duration_seconds": null
    },
    {
      "source_format": "wav",
      "target_format": "mp3",
      "object_key": "audio/interview.wav",
      "size_mb": 45.2,
      "duration_seconds": 30
    },
    {
      "source_format": "html",
      "target_format": "pdf",
      "base64_data": "PGh0bWw+PGJvZHk+PGgxPkJhc2U2NCBIVE1MPC9oMT48L2JvZHk+PC9odG1sPg==",
      "filename": "inline.html",
      "size_mb": 0.001,
      "page_limit": 1
    }
  ]
}
```

### 出参示例（异步入队）
```json
{
  "errCode": "000000",
  "errMsg": "success",
  "status": true,
  "data": {
    "status": "accepted",
    "task_id": "a3f7e9d2-4c5b-4e8a-9f2d-1a6b8c3e5d7f",
    "message": "Task accepted and scheduled for conversion"
  }
}
```

### 出参示例（同步成功）
```json
{
  "errCode": "000000",
  "errMsg": "success",
  "status": true,
  "data": {
    "status": "success",
    "task_id": "4b52c3e6-5c2a-4f9b-9d3c-17e7f6e3e111",
    "message": "Task completed synchronously",
    "results": [
      {
        "source": "docx",
        "target": "pdf",
        "status": "success",
        "object_key": "converted/4b52c3e6-5c2a-4f9b-9d3c-17e7f6e3e111/report.pdf",
        "output_path": null,
        "metadata": {"note": "Converted via LibreOffice soffice", "page_limit": 5}
      }
    ]
  }
}
```

### 出参示例（失败，含源定位）
```json
{
  "errCode": "000001",
  "errMsg": "Unsupported format doc->mp4 (source=https://example.com/report.doc)",
  "status": false,
  "data": {
    "status": "failure",
    "error_code": "ERR_FORMAT_UNSUPPORTED",
    "error_status": 400,
    "message": "Unsupported format doc->mp4 (source=https://example.com/report.doc)"
  }
}
```

## Celery 任务：conversion.handle_batch

### 入参字段（Celery Payload）
| 父参数 | 参数 | 类型 | 必选 | 说明 |
|---|---|---|---|---|
| root | task_id | string | 否 | 任务 ID（可由调用方提供，未传则 worker 生成） |
| root | files | array | 是 | 待转换文件列表，结构与 API `files[]` 相同（source_format/target_format/input_url/object_key/base64_data/filename/size_mb/page_limit/duration_seconds） |
| root | priority | string | 否 | `low`/`normal`/`high`，默认 `normal` |
| root | callback_url | string | 否 | 回调 URL（可选，透传自 API） |
| root | storage | object | 否 | 存储覆盖配置（endpoint/access_key/secret_key/bucket） |
| root | requested_by | string | 否 | 调用来源标识 |

### 出参字段（Celery Result）
| 父参数 | 参数 | 类型 | 必选 | 说明 |
|---|---|---|---|---|
| root | task_id | string | 是 | 任务 ID |
| root | results | array | 是 | 每个文件的处理结果 |
| results[] | source | string | 是 | 源格式 |
| results[] | target | string | 是 | 目标格式 |
| results[] | status | string | 是 | `success` / `failed` |
| results[] | object_key | string | 否 | 输出对象键（成功时可能存在） |
| results[] | output_path | string | 否 | 本地输出路径（成功且未上传时存在） |
| results[] | metadata | object | 否 | 插件返回元数据（如 page_limit/duration/notes） |
| results[] | reason | string | 否 | 失败原因，含 source 定位，如 `Input preparation failed (source=audio/interview.wav): ...` |

### Celery 入参示例
```json
{
  "task_id": "f8c6a2fd-9d76-4bf0-9f2f-5e9f6a6e2c11",
  "priority": "normal",
  "storage": {
    "endpoint": "http://minio:9000",
    "access_key": "your-ak",
    "secret_key": "your-sk",
    "bucket": "custom-bucket"
  },
  "files": [
    {
      "source_format": "docx",
      "target_format": "pdf",
      "input_url": "https://example.com/report.docx",
      "size_mb": 3.2,
      "page_limit": 5
    },
    {
      "source_format": "wav",
      "target_format": "mp3",
      "object_key": "audio/interview.wav",
      "size_mb": 48.5,
      "duration_seconds": 30
    }
  ]
}
```

### Celery 出参示例（成功 + 失败混合）
```json
{
  "task_id": "f8c6a2fd-9d76-4bf0-9f2f-5e9f6a6e2c11",
  "results": [
    {
      "source": "docx",
      "target": "pdf",
      "status": "success",
      "object_key": "converted/f8c6a2fd-9d76-4bf0-9f2f-5e9f6a6e2c11/report.pdf",
      "metadata": {"page_limit": 5}
    },
    {
      "source": "wav",
      "target": "mp3",
      "status": "failed",
      "reason": "Input preparation failed (source=audio/interview.wav): FileNotFoundError('...')"
    }
  ]
}
```

---

# 文档探针 + 推荐 + 自适应切片接口

## 基本信息
服务名称：智能切片推荐与执行 API 接口  
请求方：知识加工编排  
响应方：文档探针/推荐/切片服务  
服务地址：`http://{IP}:{port}/km/rag/knowledgeTransformer/api/v1/adaptive-slice`  
请求方式：POST  
Content-Type：application/json  
接口类型：探针+策略推荐+切片执行一体化接口（支持 async/sync）

## 入参字段（Body）
| 父参数 | 参数 | 类型 | 必选 | 说明 |
|---|---|---|---|---|
| root | task_name | string | 是 | 任务名称 |
| root | priority | string | 否 | `low`/`normal`/`high`，默认 `normal` |
| root | mode | string | 否 | `async`（默认，入队）/`sync`（同步返回切片结果，适合小文件） |
| root | callback_url | string | 否 | 回调 URL，异步完成后推送结果 |
| root | storage | object | 否 | 对象存储覆盖配置（endpoint/access_key/secret_key/bucket） |
| root | files | array | 是 | 待处理文件列表 |
| files[] | input_url | string | 否 | 下载 URL（三选一） |
| files[] | object_key | string | 否 | 对象键名（三选一） |
| files[] | base64_data | string | 否 | 内联 base64 数据（三选一） |
| files[] | filename | string | 否 | 文件名，配合 base64 使用 |
| files[] | size_mb | number | 是 | 文件大小（MB），用于限流校验 |
| files[] | source_format | string | 是 | 源格式，如 docx/pdf/pptx/txt/log/png/mp4 |
| files[] | trace_id | string | 否 | 透传链路追踪 ID |
| files[] | page_limit | number | 否 | 页数裁剪（文档类） |
| files[] | duration_seconds | number | 否 | 时长裁剪（音视频） |
| root | options | object | 否 | 策略/切片可选配置 |
| options | custom | object | 否 | 自定义分隔符策略配置 |
| custom | enable | boolean | 否 | 是否开启自定义分隔符策略，默认 false |
| custom | delimiters | array(string) | 否 | 文本或正则分隔符列表，如 "^Q:|^A:", "^### " |
| custom | min_segments | number | 否 | 分隔符命中阈值，默认 5，低于则回退基线 |
| custom | min_segment_len | number | 否 | 最小段长，默认 30，短段会合并/丢弃 |
| custom | max_segment_len | number | 否 | 最大段长，默认 800，超长将二次拆分 |
| options | llm_prior | boolean | 否 | 是否启用 LLM 语义先验，默认 false |
| options | emit_candidates | boolean | 否 | 是否返回候选策略得分，默认 false |
| options | target_length | number | 否 | 文本块目标长度，默认 220（150~400） |
| options | overlap_ratio | number | 否 | 文本滑窗重叠比例，默认 0.15（0~0.3） |

## 出参字段（ResBean）
| 父参数 | 参数 | 类型 | 必选 | 说明 |
|---|---|---|---|---|
| root | errCode | string | 是 | 返回码，成功 `000000` |
| root | errMsg | string | 是 | 描述信息 |
| root | status | boolean | 是 | `true`/`false` |
| root | data | object | 是 | 业务返回体 |
| data | status | string | 是 | `accepted`/`success`/`failure` |
| data | task_id | string | 否 | 任务 ID |
| data | message | string | 否 | 说明信息 |
| data | error_code | string | 否 | 失败时错误码（如 `PROBE_TIMEOUT`） |
| data | error_status | number | 否 | 失败时 HTTP 状态码 |
| data | recommendation | object | 否 | 推荐结果（async 返回为空，仅含 task_id） |
| recommendation | strategy_id | string | 否 | 选定策略，如 `heading_block_length_split`/`custom_delimiter_split` |
| recommendation | params | object | 否 | 策略参数（target_length/overlap/preserve_tables/custom.* 等） |
| recommendation | profile | object | 否 | 探针画像（heading_ratio/list_ratio/table_ratio/code_ratio/p90_para_len 等） |
| recommendation | candidates | object | 否 | 候选策略得分（当 emit_candidates=true） |
| recommendation | delimiter_hits | number | 否 | 分隔符命中段数（自定义策略时返回） |
| data | chunks | array | 否 | 切片结果列表（sync 或回调时返回） |
| chunks[] | chunk_id | string | 是 | 切片唯一 ID |
| chunks[] | text | string | 否 | 切片文本（媒体类为空） |
| chunks[] | strategy_id | string | 是 | 生成该切片的策略 ID |
| chunks[] | block_type | string | 是 | 来源块类型：paragraph/list/table/code/math/image/slide_text |
| chunks[] | page_index | number | 否 | 页/幻灯片索引 |
| chunks[] | anchor_id | string | 否 | 关联标题/段落 ID |
| chunks[] | overlap_ratio | number | 否 | 该切片的重叠比例 |
| chunks[] | fallback | boolean | 否 | 是否为回退结果 |
| chunks[] | metadata | object | 否 | 其他元数据（table_block/keep_block/delimiter_used/segment_index 等） |

## 报文样例

### 入参示例（async）
```json
{
  "task_name": "adaptive-slice-demo",
  "mode": "async",
  "priority": "high",
  "callback_url": "https://your-service.com/webhook/slice-finish",
  "options": {
    "custom": {
      "enable": true,
      "delimiters": ["^Q:", "^A:"],
      "min_segments": 4,
      "min_segment_len": 20,
      "max_segment_len": 500
    },
    "emit_candidates": true
  },
  "files": [
    {
      "input_url": "https://storage.example.com/dialogue.txt",
      "source_format": "txt",
      "filename": "dialogue.txt",
      "size_mb": 1.2
    }
  ]
}
```

### 出参示例（async 入队）
```json
{
  "errCode": "000000",
  "errMsg": "success",
  "status": true,
  "data": {
    "status": "accepted",
    "task_id": "8e7c1f7a-2b4d-4d8f-bf6b-9f1a2c3d4e5f",
    "message": "Task accepted"
  }
}
```

### 出参示例（sync 成功，含切片）
```json
{
  "errCode": "000000",
  "errMsg": "success",
  "status": true,
  "data": {
    "status": "success",
    "task_id": "f1d2c3b4-5678-90ab-cdef-1234567890ab",
    "recommendation": {
      "strategy_id": "custom_delimiter_split",
      "delimiter_hits": 12,
      "params": {
        "target_length": 220,
        "overlap_ratio": 0.1,
        "custom": {
          "enable": true,
          "delimiters": ["^Q:", "^A:"],
          "min_segments": 4,
          "min_segment_len": 20,
          "max_segment_len": 500
        }
      },
      "profile": {
        "heading_ratio": 0.02,
        "list_ratio": 0.0,
        "table_ratio": 0.0,
        "code_ratio": 0.0,
        "p90_para_len": 160
      },
      "candidates": {
        "custom_delimiter_split": 1.0,
        "heading_block_length_split": 0.35,
        "sentence_split_sliding": 0.55
      }
    },
    "chunks": [
      {
        "chunk_id": "c1",
        "text": "Q: 请介绍产品...",
        "strategy_id": "custom_delimiter_split",
        "block_type": "paragraph",
        "page_index": 0,
        "anchor_id": null,
        "overlap_ratio": 0.1,
        "fallback": false,
        "metadata": {"delimiter_used": "Q:", "segment_index": 1}
      },
      {
        "chunk_id": "c2",
        "text": "A: 产品是一款...",
        "strategy_id": "custom_delimiter_split",
        "block_type": "paragraph",
        "page_index": 0,
        "anchor_id": null,
        "overlap_ratio": 0.1,
        "fallback": false,
        "metadata": {"delimiter_used": "A:", "segment_index": 2}
      }
    ]
  }
}
```

### 出参示例（失败）
```json
{
  "errCode": "000001",
  "errMsg": "PROBE_TIMEOUT",
  "status": false,
  "data": {
    "status": "failure",
    "error_code": "PROBE_TIMEOUT",
    "error_status": 504,
    "message": "Probe stage timeout"
  }
}
```

---

# 文档切片策略智能推荐接口

## 基本信息
服务名称：切片策略推荐 API 接口 
请求方：知识加工编排  
响应方：文档探针/推荐服务  
服务地址：`http://{IP}:{port}/km/rag/knowledgeTransformer/api/v1/slice-recommend`  
请求方式：POST  
Content-Type：application/json  
接口类型：策略推荐（rule+统计+可选 LLM 先验），输出推荐策略及参数

## 入参字段（Body）
| 父参数 | 参数 | 类型 | 必选 | 说明 |
|---|---|---|---|---|
| root | task_name | string | 是 | 任务名称 |
| root | priority | string | 否 | `low`/`normal`/`high`，默认 `normal` |
| root | mode | string | 否 | `async`（默认，入队返回 task_id）/`sync`（同步返回推荐结果） |
| root | files | array | 是 | 待分析文件列表 |
| files[] | input_url | string | 否 | 下载 URL（三选一） |
| files[] | object_key | string | 否 | 对象键名（三选一） |
| files[] | base64_data | string | 否 | 内联 base64（三选一） |
| files[] | filename | string | 否 | 文件名，配合 base64 使用 |
| files[] | size_mb | number | 是 | 文件大小（MB） |
| files[] | source_format | string | 是 | 源格式，如 docx/pdf/pptx/txt/log |
| files[] | trace_id | string | 否 | 透传链路追踪 ID |
| files[] | page_limit | number | 否 | 页数裁剪（文档类） |
| files[] | duration_seconds | number | 否 | 时长裁剪（音视频） |
| root | options | object | 否 | 推荐选项 |
| options | custom | object | 否 | 自定义分隔符策略配置（同下） |
| custom | enable | boolean | 否 | 开启分隔符策略，默认 false |
| custom | delimiters | array(string) | 否 | 分隔符（文本/正则）列表 |
| custom | min_segments | number | 否 | 命中阈值，默认 5 |
| custom | min_segment_len | number | 否 | 最小段长，默认 30 |
| custom | max_segment_len | number | 否 | 最大段长，默认 800 |
| options | llm_prior | boolean | 否 | 启用 LLM 语义先验，默认 false |
| options | emit_candidates | boolean | 否 | 是否返回候选得分，默认 false |

## 出参字段（ResBean）
| 父参数 | 参数 | 类型 | 必选 | 说明 |
|---|---|---|---|---|
| root | errCode | string | 是 | 成功 `000000` |
| root | errMsg | string | 是 | 描述 |
| root | status | boolean | 是 | `true`/`false` |
| root | data | object | 是 | 推荐结果或入队信息 |
| data | status | string | 是 | `accepted`/`success`/`failure` |
| data | task_id | string | 否 | 任务 ID（async 时返回） |
| data | message | string | 否 | 说明信息 |
| data | error_code | string | 否 | 失败码（如 `PROBE_TIMEOUT`） |
| data | error_status | number | 否 | 失败 HTTP 状态码 |
| data | recommendation | object | 否 | 推荐结果（sync 或回调时返回） |
| recommendation | strategy_id | string | 否 | 推荐策略，如 `heading_block_length_split`/`custom_delimiter_split` |
| recommendation | params | object | 否 | 策略参数（target_length/overlap/custom.* 等） |
| recommendation | profile | object | 否 | 探针画像特征 |
| recommendation | candidates | object | 否 | 候选策略得分（emit_candidates=true 时） |
| recommendation | delimiter_hits | number | 否 | 分隔符命中段数（自定义策略时） |

## 报文样例（sync 成功）
```json
{
  "errCode": "000000",
  "errMsg": "success",
  "status": true,
  "data": {
    "status": "success",
    "task_id": "cafe-babe-1234",
    "recommendation": {
      "strategy_id": "sentence_split_sliding",
      "params": {"target_length": 240, "overlap_ratio": 0.15},
      "profile": {
        "heading_ratio": 0.08,
        "list_ratio": 0.04,
        "table_ratio": 0.02,
        "code_ratio": 0.0,
        "p90_para_len": 260
      },
      "candidates": {
        "sentence_split_sliding": 0.66,
        "heading_block_length_split": 0.62
      }
    }
  }
}
```

### 报文样例（async 入队）
```json
{
  "errCode": "000000",
  "errMsg": "success",
  "status": true,
  "data": {
    "status": "accepted",
    "task_id": "cafe-dead-beef",
    "message": "Task accepted"
  }
}
```

### 报文样例（失败）
```json
{
  "errCode": "000001",
  "errMsg": "PROBE_TIMEOUT",
  "status": false,
  "data": {
    "status": "failure",
    "error_code": "PROBE_TIMEOUT",
    "error_status": 504,
    "message": "Probe stage timeout"
  }
}
```

## Celery 任务：probe.extract_signals（探针画像）

### 入参字段（Payload）
| 父参数 | 参数 | 类型 | 必选 | 说明 |
|---|---|---|---|---|
| root | task_id | string | 否 | 任务 ID（可透传） |
| root | files | array | 是 | 待分析文件列表，结构与 API `files[]` 相同 |
| root | priority | string | 否 | `low`/`normal`/`high` |
| root | options | object | 否 | 探针选项（可透传 custom/llm/emit_candidates，供后续 recommend 使用） |

### 出参字段（Result）
| 父参数 | 参数 | 类型 | 必选 | 说明 |
|---|---|---|---|---|
| root | task_id | string | 是 | 任务 ID |
| root | results | array | 是 | 每个文件的探针画像结果 |
| results[] | source_format | string | 是 | 源格式 |
| results[] | status | string | 是 | `success`/`failed` |
| results[] | profile | object | 否 | 成功时的特征画像（heading_ratio/list_ratio/table_ratio/code_ratio/p90_para_len 等） |
| results[] | reason | string | 否 | 失败原因（含错误码） |

### Celery 入参示例（extract_signals）
```json
{
  "task_id": "probe-123",
  "priority": "normal",
  "files": [
    {
      "object_key": "docs/dialogue.txt",
      "source_format": "txt",
      "size_mb": 1.0
    }
  ]
}
```

### Celery 出参示例（extract_signals）
```json
{
  "task_id": "probe-123",
  "results": [
    {
      "source_format": "txt",
      "status": "success",
      "profile": {
        "heading_ratio": 0.01,
        "list_ratio": 0.0,
        "table_ratio": 0.0,
        "code_ratio": 0.0,
        "p90_para_len": 140
      }
    }
  ]
}
```

## Celery 任务：probe.recommend_strategy（仅推荐）

### 入参字段（Payload）
| 父参数 | 参数 | 类型 | 必选 | 说明 |
|---|---|---|---|---|
| root | task_id | string | 否 | 任务 ID（可透传） |
| root | files | array | 是 | 待分析文件列表（同 API `files[]`，可直接传或与 profile 结合） |
| root | profile | object | 否 | 预先计算的画像，可跳过 extract_signals（可选） |
| root | priority | string | 否 | `low`/`normal`/`high` |
| root | options | object | 否 | 推荐选项（custom/llm/emit_candidates） |
| options | custom | object | 否 | 自定义分隔符配置（enable/delimiters/min_segments/min_segment_len/max_segment_len） |
| options | llm_prior | boolean | 否 | 启用 LLM 先验 |
| options | emit_candidates | boolean | 否 | 返回候选得分 |

### 出参字段（Result）
| 父参数 | 参数 | 类型 | 必选 | 说明 |
|---|---|---|---|---|
| root | task_id | string | 是 | 任务 ID |
| root | results | array | 是 | 每个文件的推荐结果 |
| results[] | source_format | string | 是 | 源格式 |
| results[] | status | string | 是 | `success`/`failed` |
| results[] | recommendation | object | 否 | 成功时的推荐结果（strategy_id/params/profile/candidates/delimiter_hits） |
| results[] | reason | string | 否 | 失败原因（含错误码） |

### Celery 入参示例（recommend_strategy）
```json
{
  "task_id": "rec-123",
  "priority": "normal",
  "options": {
    "custom": {"enable": true, "delimiters": ["^Q:", "^A:"], "min_segments": 4},
    "emit_candidates": true
  },
  "files": [
    {
      "object_key": "docs/dialogue.txt",
      "source_format": "txt",
      "size_mb": 1.0
    }
  ]
}
```

### Celery 出参示例（recommend_strategy）
```json
{
  "task_id": "rec-123",
  "results": [
    {
      "source_format": "txt",
      "status": "success",
      "recommendation": {
        "strategy_id": "custom_delimiter_split",
        "delimiter_hits": 9,
        "params": {"target_length": 220, "overlap_ratio": 0.1},
        "profile": {"heading_ratio": 0.01, "list_ratio": 0.0, "table_ratio": 0.0, "code_ratio": 0.0, "p90_para_len": 140},
        "candidates": {"custom_delimiter_split": 1.0, "sentence_split_sliding": 0.55}
      }
    }
  ]
}
```
